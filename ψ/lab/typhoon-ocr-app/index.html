<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Typhoon OCR - ‡πÅ‡∏õ‡∏•‡∏á‡∏†‡∏≤‡∏û‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Instrument+Serif:ital@0;1&family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-primary: #0a0a0f;
      --bg-secondary: #12121a;
      --bg-card: #1a1a24;
      --accent-gold: #d4a853;
      --accent-gold-dim: #a8843f;
      --accent-teal: #3d9a8b;
      --accent-teal-dim: #2d7a6b;
      --text-primary: #f5f5f0;
      --text-secondary: #9a9a9a;
      --text-muted: #5a5a5a;
      --border-subtle: rgba(255,255,255,0.06);
      --border-active: rgba(212,168,83,0.4);
      --gradient-gold: linear-gradient(135deg, #d4a853 0%, #e8c878 50%, #d4a853 100%);
      --gradient-teal: linear-gradient(135deg, #2d7a6b 0%, #3d9a8b 100%);
      --shadow-glow: 0 0 60px rgba(212,168,83,0.15);
      --radius-sm: 8px;
      --radius-md: 16px;
      --radius-lg: 24px;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Sarabun', sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      min-height: 100vh;
      line-height: 1.6;
      overflow-x: hidden;
    }

    /* Background Pattern */
    body::before {
      content: '';
      position: fixed;
      inset: 0;
      background:
        radial-gradient(ellipse 80% 50% at 50% -20%, rgba(212,168,83,0.08) 0%, transparent 50%),
        radial-gradient(ellipse 60% 40% at 80% 100%, rgba(61,154,139,0.06) 0%, transparent 40%);
      pointer-events: none;
      z-index: -1;
    }

    /* Thai Pattern Overlay */
    .thai-pattern {
      position: fixed;
      top: 0;
      right: 0;
      width: 400px;
      height: 400px;
      opacity: 0.03;
      background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M30 5 L55 30 L30 55 L5 30 Z' fill='none' stroke='%23d4a853' stroke-width='1'/%3E%3Ccircle cx='30' cy='30' r='8' fill='none' stroke='%23d4a853' stroke-width='1'/%3E%3C/svg%3E");
      pointer-events: none;
      z-index: -1;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 40px 24px;
    }

    /* Header */
    header {
      text-align: center;
      margin-bottom: 48px;
    }

    .logo {
      display: inline-flex;
      align-items: center;
      gap: 16px;
      margin-bottom: 16px;
    }

    .logo-icon {
      width: 56px;
      height: 56px;
      background: var(--gradient-gold);
      border-radius: var(--radius-md);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 28px;
      box-shadow: var(--shadow-glow);
    }

    h1 {
      font-family: 'Instrument Serif', serif;
      font-size: clamp(2.5rem, 5vw, 3.5rem);
      font-weight: 400;
      letter-spacing: -0.02em;
      background: var(--gradient-gold);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .tagline {
      color: var(--text-secondary);
      font-size: 1.1rem;
      font-weight: 300;
      margin-top: 8px;
    }

    /* Main Grid */
    .main-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 32px;
      align-items: start;
    }

    @media (max-width: 900px) {
      .main-grid {
        grid-template-columns: 1fr;
      }
    }

    /* Card Styles */
    .card {
      background: var(--bg-card);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-lg);
      padding: 32px;
      transition: all 0.3s ease;
    }

    .card-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 24px;
    }

    .card-icon {
      width: 40px;
      height: 40px;
      border-radius: var(--radius-sm);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
    }

    .card-icon.gold {
      background: rgba(212,168,83,0.15);
      color: var(--accent-gold);
    }

    .card-icon.teal {
      background: rgba(61,154,139,0.15);
      color: var(--accent-teal);
    }

    .card-title {
      font-size: 1.25rem;
      font-weight: 600;
    }

    /* API Key Input */
    .api-section {
      margin-bottom: 24px;
      padding-bottom: 24px;
      border-bottom: 1px solid var(--border-subtle);
    }

    .input-group {
      position: relative;
    }

    .input-group label {
      display: block;
      font-size: 0.875rem;
      color: var(--text-secondary);
      margin-bottom: 8px;
    }

    .input-group input,
    .input-group select {
      width: 100%;
      padding: 14px 16px;
      background: var(--bg-secondary);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-sm);
      color: var(--text-primary);
      font-family: inherit;
      font-size: 1rem;
      transition: all 0.2s ease;
    }

    .input-group input:focus,
    .input-group select:focus {
      outline: none;
      border-color: var(--accent-gold-dim);
      box-shadow: 0 0 0 3px rgba(212,168,83,0.1);
    }

    .input-group input::placeholder {
      color: var(--text-muted);
    }

    /* Mode Selection */
    .mode-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
      margin-bottom: 24px;
    }

    .mode-btn {
      padding: 16px 12px;
      background: var(--bg-secondary);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-sm);
      color: var(--text-secondary);
      font-family: inherit;
      font-size: 0.875rem;
      cursor: pointer;
      transition: all 0.2s ease;
      text-align: center;
    }

    .mode-btn:hover {
      border-color: var(--text-muted);
      color: var(--text-primary);
    }

    .mode-btn.active {
      background: rgba(212,168,83,0.1);
      border-color: var(--accent-gold-dim);
      color: var(--accent-gold);
    }

    .mode-btn .mode-icon {
      font-size: 1.5rem;
      margin-bottom: 8px;
    }

    .mode-btn .mode-label {
      display: block;
      font-weight: 500;
    }

    .mode-btn .mode-desc {
      display: block;
      font-size: 0.75rem;
      color: var(--text-muted);
      margin-top: 4px;
    }

    /* Upload Zone */
    .upload-zone {
      position: relative;
      border: 2px dashed var(--border-subtle);
      border-radius: var(--radius-md);
      padding: 48px 24px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      background: var(--bg-secondary);
      overflow: hidden;
    }

    .upload-zone::before {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(135deg, rgba(212,168,83,0.05) 0%, transparent 50%);
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .upload-zone:hover,
    .upload-zone.dragover {
      border-color: var(--accent-gold-dim);
      background: rgba(212,168,83,0.03);
    }

    .upload-zone:hover::before,
    .upload-zone.dragover::before {
      opacity: 1;
    }

    .upload-zone.has-file {
      padding: 24px;
    }

    .upload-icon {
      font-size: 3rem;
      margin-bottom: 16px;
      opacity: 0.6;
    }

    .upload-text {
      color: var(--text-secondary);
      margin-bottom: 8px;
    }

    .upload-text strong {
      color: var(--accent-gold);
    }

    .upload-hint {
      font-size: 0.875rem;
      color: var(--text-muted);
    }

    .upload-input {
      display: none;
    }

    /* Preview */
    .preview-container {
      position: relative;
      max-height: 400px;
      overflow: hidden;
      border-radius: var(--radius-sm);
    }

    .preview-container img {
      width: 100%;
      height: auto;
      display: block;
      border-radius: var(--radius-sm);
    }

    .preview-overlay {
      position: absolute;
      inset: 0;
      background: linear-gradient(to top, var(--bg-card) 0%, transparent 30%);
      pointer-events: none;
    }

    .preview-info {
      position: absolute;
      bottom: 16px;
      left: 16px;
      right: 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .file-name {
      font-size: 0.875rem;
      color: var(--text-primary);
      background: rgba(0,0,0,0.6);
      padding: 6px 12px;
      border-radius: var(--radius-sm);
      backdrop-filter: blur(8px);
    }

    .clear-btn {
      padding: 8px 16px;
      background: rgba(220,53,69,0.2);
      border: 1px solid rgba(220,53,69,0.3);
      border-radius: var(--radius-sm);
      color: #ff6b6b;
      font-family: inherit;
      font-size: 0.875rem;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .clear-btn:hover {
      background: rgba(220,53,69,0.3);
    }

    /* Extract Button */
    .extract-btn {
      width: 100%;
      padding: 18px 24px;
      margin-top: 24px;
      background: var(--gradient-gold);
      border: none;
      border-radius: var(--radius-sm);
      color: var(--bg-primary);
      font-family: inherit;
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .extract-btn:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(212,168,83,0.3);
    }

    .extract-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .extract-btn.loading {
      color: transparent;
    }

    .extract-btn .spinner {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .extract-btn .spinner::after {
      content: '';
      width: 24px;
      height: 24px;
      border: 3px solid rgba(10,10,15,0.3);
      border-top-color: var(--bg-primary);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Result Card */
    .result-card {
      min-height: 500px;
      display: flex;
      flex-direction: column;
    }

    .result-placeholder {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: var(--text-muted);
      text-align: center;
      padding: 48px;
    }

    .result-placeholder .placeholder-icon {
      font-size: 4rem;
      margin-bottom: 16px;
      opacity: 0.3;
    }

    /* Result Content */
    .result-content {
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    .result-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
      padding-bottom: 16px;
      border-bottom: 1px solid var(--border-subtle);
    }

    .result-stats {
      display: flex;
      gap: 16px;
    }

    .stat {
      font-size: 0.875rem;
      color: var(--text-secondary);
    }

    .stat strong {
      color: var(--accent-teal);
    }

    .copy-btn {
      padding: 8px 16px;
      background: rgba(61,154,139,0.15);
      border: 1px solid rgba(61,154,139,0.3);
      border-radius: var(--radius-sm);
      color: var(--accent-teal);
      font-family: inherit;
      font-size: 0.875rem;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .copy-btn:hover {
      background: rgba(61,154,139,0.25);
    }

    .copy-btn.copied {
      background: var(--accent-teal);
      color: var(--bg-primary);
    }

    .result-text {
      flex: 1;
      background: var(--bg-secondary);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-sm);
      padding: 20px;
      font-size: 1rem;
      line-height: 1.8;
      white-space: pre-wrap;
      overflow-y: auto;
      max-height: 400px;
    }

    .result-text::-webkit-scrollbar {
      width: 8px;
    }

    .result-text::-webkit-scrollbar-track {
      background: var(--bg-secondary);
    }

    .result-text::-webkit-scrollbar-thumb {
      background: var(--text-muted);
      border-radius: 4px;
    }

    /* Error State */
    .error-message {
      padding: 16px;
      background: rgba(220,53,69,0.1);
      border: 1px solid rgba(220,53,69,0.2);
      border-radius: var(--radius-sm);
      color: #ff6b6b;
      font-size: 0.9rem;
    }

    /* Footer */
    footer {
      text-align: center;
      margin-top: 48px;
      padding-top: 24px;
      border-top: 1px solid var(--border-subtle);
      color: var(--text-muted);
      font-size: 0.875rem;
    }

    footer a {
      color: var(--accent-gold);
      text-decoration: none;
    }

    footer a:hover {
      text-decoration: underline;
    }

    /* Animations */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .fade-in {
      animation: fadeIn 0.4s ease forwards;
    }

    /* Toast */
    .toast {
      position: fixed;
      bottom: 24px;
      right: 24px;
      padding: 16px 24px;
      background: var(--bg-card);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-sm);
      color: var(--text-primary);
      font-size: 0.9rem;
      box-shadow: 0 8px 32px rgba(0,0,0,0.3);
      transform: translateY(100px);
      opacity: 0;
      transition: all 0.3s ease;
      z-index: 1000;
    }

    .toast.show {
      transform: translateY(0);
      opacity: 1;
    }

    .toast.success {
      border-color: var(--accent-teal);
    }
  </style>
</head>
<body>
  <div class="thai-pattern"></div>

  <div class="container">
    <header>
      <div class="logo">
        <div class="logo-icon">üåÄ</div>
        <h1>Typhoon OCR</h1>
      </div>
      <p class="tagline">‡πÅ‡∏õ‡∏•‡∏á‡∏†‡∏≤‡∏û‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏ï‡∏±‡∏ß‡∏û‡∏¥‡∏°‡∏û‡πå‡πÅ‡∏•‡∏∞‡∏•‡∏≤‡∏¢‡∏°‡∏∑‡∏≠</p>
    </header>

    <div class="main-grid">
      <!-- Upload Section -->
      <div class="card">
        <div class="card-header">
          <div class="card-icon gold">üìÑ</div>
          <h2 class="card-title">‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå</h2>
        </div>

        <!-- API Key -->
        <div class="api-section">
          <div class="input-group">
            <label>Typhoon API Key</label>
            <input type="password" id="apiKey" placeholder="sk-..." autocomplete="off">
          </div>
        </div>

        <!-- Mode Selection -->
        <div class="mode-grid">
          <button class="mode-btn active" data-mode="v1.5">
            <span class="mode-icon">‚ú®</span>
            <span class="mode-label">v1.5</span>
            <span class="mode-desc">‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</span>
          </button>
          <button class="mode-btn" data-mode="default">
            <span class="mode-icon">üìù</span>
            <span class="mode-label">Default</span>
            <span class="mode-desc">Markdown</span>
          </button>
          <button class="mode-btn" data-mode="structure">
            <span class="mode-icon">üìä</span>
            <span class="mode-label">Structure</span>
            <span class="mode-desc">HTML Table</span>
          </button>
        </div>

        <!-- Language Selection for v1.5 -->
        <div class="input-group" id="langGroup" style="margin-bottom: 24px;">
          <label>‡∏†‡∏≤‡∏©‡∏≤‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</label>
          <select id="figureLanguage">
            <option value="Thai">‡πÑ‡∏ó‡∏¢</option>
            <option value="English">English</option>
          </select>
        </div>

        <!-- Upload Zone -->
        <div class="upload-zone" id="uploadZone">
          <div class="upload-icon">üìÅ</div>
          <p class="upload-text">‡∏•‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏°‡∏≤‡∏ß‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà ‡∏´‡∏£‡∏∑‡∏≠ <strong>‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</strong></p>
          <p class="upload-hint">‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö PDF, PNG, JPG, JPEG</p>
          <input type="file" class="upload-input" id="fileInput" accept=".pdf,.png,.jpg,.jpeg">
        </div>

        <!-- Preview (hidden by default) -->
        <div class="preview-container" id="previewContainer" style="display: none;">
          <img id="previewImage" alt="Preview">
          <div class="preview-overlay"></div>
          <div class="preview-info">
            <span class="file-name" id="fileName"></span>
            <button class="clear-btn" id="clearBtn">‡∏•‡πâ‡∏≤‡∏á</button>
          </div>
        </div>

        <button class="extract-btn" id="extractBtn" disabled>
          <span class="btn-text">üîç ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</span>
          <span class="spinner" style="display: none;"></span>
        </button>
      </div>

      <!-- Result Section -->
      <div class="card result-card">
        <div class="card-header">
          <div class="card-icon teal">üìã</div>
          <h2 class="card-title">‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå</h2>
        </div>

        <div class="result-placeholder" id="resultPlaceholder">
          <div class="placeholder-icon">üîÆ</div>
          <p>‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÅ‡∏õ‡∏•‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</p>
          <p style="font-size: 0.875rem; margin-top: 8px;">‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏ó‡∏±‡πâ‡∏á‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ ‡∏•‡∏≤‡∏¢‡∏°‡∏∑‡∏≠ ‡πÅ‡∏•‡∏∞‡∏ï‡∏≤‡∏£‡∏≤‡∏á</p>
        </div>

        <div class="result-content" id="resultContent" style="display: none;">
          <div class="result-header">
            <div class="result-stats">
              <span class="stat">‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£: <strong id="charCount">0</strong></span>
              <span class="stat">‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î: <strong id="lineCount">0</strong></span>
            </div>
            <button class="copy-btn" id="copyBtn">
              <span>üìã</span>
              <span class="copy-text">‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å</span>
            </button>
          </div>
          <div class="result-text" id="resultText"></div>
        </div>

        <div class="error-message" id="errorMessage" style="display: none;"></div>
      </div>
    </div>

    <footer>
      <p>Powered by <a href="https://github.com/scb-10x/typhoon-ocr" target="_blank">Typhoon OCR</a> by SCB 10X</p>
    </footer>
  </div>

  <div class="toast" id="toast"></div>

  <script>
    // Elements
    const uploadZone = document.getElementById('uploadZone');
    const fileInput = document.getElementById('fileInput');
    const previewContainer = document.getElementById('previewContainer');
    const previewImage = document.getElementById('previewImage');
    const fileName = document.getElementById('fileName');
    const clearBtn = document.getElementById('clearBtn');
    const extractBtn = document.getElementById('extractBtn');
    const apiKeyInput = document.getElementById('apiKey');
    const modeBtns = document.querySelectorAll('.mode-btn');
    const langGroup = document.getElementById('langGroup');
    const figureLanguage = document.getElementById('figureLanguage');
    const resultPlaceholder = document.getElementById('resultPlaceholder');
    const resultContent = document.getElementById('resultContent');
    const resultText = document.getElementById('resultText');
    const charCount = document.getElementById('charCount');
    const lineCount = document.getElementById('lineCount');
    const copyBtn = document.getElementById('copyBtn');
    const errorMessage = document.getElementById('errorMessage');
    const toast = document.getElementById('toast');

    let selectedFile = null;
    let selectedMode = 'v1.5';

    // Load saved API key
    const savedApiKey = localStorage.getItem('typhoon_api_key');
    if (savedApiKey) {
      apiKeyInput.value = savedApiKey;
    }

    // Save API key on change
    apiKeyInput.addEventListener('change', () => {
      localStorage.setItem('typhoon_api_key', apiKeyInput.value);
    });

    // Mode selection
    modeBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        modeBtns.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        selectedMode = btn.dataset.mode;

        // Show/hide language selector for v1.5
        langGroup.style.display = selectedMode === 'v1.5' ? 'block' : 'none';
      });
    });

    // Drag and drop
    uploadZone.addEventListener('dragover', (e) => {
      e.preventDefault();
      uploadZone.classList.add('dragover');
    });

    uploadZone.addEventListener('dragleave', () => {
      uploadZone.classList.remove('dragover');
    });

    uploadZone.addEventListener('drop', (e) => {
      e.preventDefault();
      uploadZone.classList.remove('dragover');
      const file = e.dataTransfer.files[0];
      if (file) handleFile(file);
    });

    uploadZone.addEventListener('click', () => {
      fileInput.click();
    });

    fileInput.addEventListener('change', () => {
      if (fileInput.files[0]) {
        handleFile(fileInput.files[0]);
      }
    });

    function handleFile(file) {
      const validTypes = ['application/pdf', 'image/png', 'image/jpeg', 'image/jpg'];
      if (!validTypes.includes(file.type)) {
        showToast('‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞ PDF, PNG, JPG ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô', 'error');
        return;
      }

      selectedFile = file;
      fileName.textContent = file.name;

      // Show preview
      if (file.type.startsWith('image/')) {
        const reader = new FileReader();
        reader.onload = (e) => {
          previewImage.src = e.target.result;
        };
        reader.readAsDataURL(file);
      } else {
        // PDF - show placeholder
        previewImage.src = 'data:image/svg+xml,' + encodeURIComponent(`
          <svg width="400" height="300" xmlns="http://www.w3.org/2000/svg">
            <rect width="100%" height="100%" fill="#1a1a24"/>
            <text x="50%" y="45%" text-anchor="middle" fill="#d4a853" font-size="48">üìÑ</text>
            <text x="50%" y="60%" text-anchor="middle" fill="#9a9a9a" font-size="16">PDF Document</text>
          </svg>
        `);
      }

      uploadZone.style.display = 'none';
      previewContainer.style.display = 'block';
      previewContainer.classList.add('fade-in');
      extractBtn.disabled = false;
    }

    clearBtn.addEventListener('click', () => {
      selectedFile = null;
      fileInput.value = '';
      uploadZone.style.display = 'block';
      previewContainer.style.display = 'none';
      extractBtn.disabled = true;
      resultPlaceholder.style.display = 'flex';
      resultContent.style.display = 'none';
      errorMessage.style.display = 'none';
    });

    // Extract
    extractBtn.addEventListener('click', async () => {
      if (!selectedFile) return;

      const apiKey = apiKeyInput.value.trim();
      if (!apiKey) {
        showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà API Key', 'error');
        apiKeyInput.focus();
        return;
      }

      // Show loading
      extractBtn.classList.add('loading');
      extractBtn.querySelector('.btn-text').style.visibility = 'hidden';
      extractBtn.querySelector('.spinner').style.display = 'flex';
      extractBtn.disabled = true;
      errorMessage.style.display = 'none';

      try {
        const result = await extractText(selectedFile, apiKey, selectedMode);

        // Show result
        resultPlaceholder.style.display = 'none';
        resultContent.style.display = 'flex';
        resultContent.classList.add('fade-in');
        resultText.textContent = result;
        charCount.textContent = result.length.toLocaleString();
        lineCount.textContent = result.split('\n').length.toLocaleString();

        showToast('‡πÅ‡∏õ‡∏•‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‚ú®', 'success');
      } catch (error) {
        errorMessage.textContent = `‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${error.message}`;
        errorMessage.style.display = 'block';
        showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', 'error');
      } finally {
        extractBtn.classList.remove('loading');
        extractBtn.querySelector('.btn-text').style.visibility = 'visible';
        extractBtn.querySelector('.spinner').style.display = 'none';
        extractBtn.disabled = false;
      }
    });

    async function extractText(file, apiKey, taskType) {
      // Convert file to base64
      const base64 = await fileToBase64(file);
      const isImage = file.type.startsWith('image/');

      // Build prompt based on task type
      let prompt;
      const lang = figureLanguage.value;

      if (taskType === 'v1.5') {
        prompt = `Extract all text from the image.
Instructions:
- Only return the clean Markdown.
- Do not include any explanation or extra text.
- You must include all information on the page.

Formatting Rules:
- Tables: Render tables using <table>...</table> in clean HTML format.
- Equations: Render equations using LaTeX syntax with inline ($...$) and block ($$...$$).
- Images/Charts: Wrap visual areas in:
<figure>
Describe the image's main elements, note contextual clues, mention visible text, provide deeper analysis.
Describe in ${lang}.
</figure>
- Page Numbers: Wrap in <page_number>...</page_number>
- Checkboxes: Use ‚òê for unchecked and ‚òë for checked boxes.`;
      } else if (taskType === 'structure') {
        prompt = `Below is an image of a document page. Your task is to return the markdown representation of this document, presenting tables in HTML format as they naturally appear.
If the document contains images or figures, analyze them and include the tag <figure>IMAGE_ANALYSIS</figure> in the appropriate location.
Your final output must be in JSON format with a single key "natural_text" containing the response.`;
      } else {
        prompt = `Below is an image of a document page along with its dimensions. Simply return the markdown representation of this document, presenting tables in markdown format as they naturally appear.
If the document contains images, use a placeholder like dummy.png for each image.
Your final output must be in JSON format with a single key "natural_text" containing the response.`;
      }

      // Build messages
      const messages = [
        {
          role: 'user',
          content: [
            { type: 'text', text: prompt },
            {
              type: 'image_url',
              image_url: {
                url: `data:${file.type};base64,${base64}`
              }
            }
          ]
        }
      ];

      // Call API
      const response = await fetch('https://api.opentyphoon.ai/v1/chat/completions', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${apiKey}`
        },
        body: JSON.stringify({
          model: 'typhoon-ocr',
          messages: messages,
          max_tokens: 16384,
          temperature: 0.1,
          top_p: 0.6
        })
      });

      if (!response.ok) {
        const error = await response.json().catch(() => ({}));
        throw new Error(error.error?.message || `API Error: ${response.status}`);
      }

      const data = await response.json();
      let text = data.choices[0].message.content;

      // Parse JSON for default/structure modes
      if (taskType !== 'v1.5') {
        try {
          const parsed = JSON.parse(text);
          text = parsed.natural_text || text;
        } catch (e) {
          // Keep as-is if not valid JSON
        }
      }

      return text;
    }

    function fileToBase64(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => {
          const base64 = reader.result.split(',')[1];
          resolve(base64);
        };
        reader.onerror = reject;
        reader.readAsDataURL(file);
      });
    }

    // Copy button
    copyBtn.addEventListener('click', async () => {
      const text = resultText.textContent;
      await navigator.clipboard.writeText(text);

      copyBtn.classList.add('copied');
      copyBtn.querySelector('.copy-text').textContent = '‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß!';

      setTimeout(() => {
        copyBtn.classList.remove('copied');
        copyBtn.querySelector('.copy-text').textContent = '‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å';
      }, 2000);
    });

    // Toast
    function showToast(message, type = 'info') {
      toast.textContent = message;
      toast.className = 'toast show' + (type === 'success' ? ' success' : '');

      setTimeout(() => {
        toast.classList.remove('show');
      }, 3000);
    }
  </script>
</body>
</html>
